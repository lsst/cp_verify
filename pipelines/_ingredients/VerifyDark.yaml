description: cp_verify DARK calibration verification
imports:
  - location: $ANALYSIS_TOOLS_DIR/pipelines/cpCore.yaml
    include:
      - analyzeDarkCore
      - analyzeDarkDetCore
tasks:
  verifyDarkApply:
    class: lsst.ip.isr.isrTask.IsrTask
    config:
      connections.ccdExposure: 'raw'
      connections.outputExposure: 'verifyDarkProc'
      connections.outputBin1Exposure: 'verifyDarkProcBin8'
      connections.outputBin2Exposure: 'verifyDarkProcBin64'
      # Disable downstream processing.
      overscan.fitType: 'MEDIAN_PER_ROW'
      doDark: true
      doFlat: false
      doApplyGains: false
      doFringe: false
      doCalculateStatistics: true
      isrStats.doCopyCalibDistributionStatistics: true
      doBinnedExposures: true
      binFactor1: 8
      binFactor2: 64
  verifyDarkChip:
    class: lsst.cp.verify.CpVerifyDarkTask
    config:
      connections.inputExp: 'verifyDarkProc'
      connections.taskMetadata: 'verifyDarkApply_metadata'
      connections.outputStats: 'verifyDarkDetStats'
      connections.outputResults: 'verifyDarkDetResults'
      useIsrStatistics: true
  verifyDarkExp:
    class: lsst.cp.verify.CpVerifyExpMergeTask
    config:
      connections.inputStats: 'verifyDarkDetStats'
      connections.inputResults: 'verifyDarkDetResults'
      connections.outputStats: 'verifyDarkExpStats'
      connections.outputResults: 'verifyDarkExpResults'
      hasInputResults: true
      hasMatrixCatalog: false
  verifyDark:
    class: lsst.cp.verify.CpVerifyRunMergeTask
    config:
      connections.inputStats: 'verifyDarkExpStats'
      connections.inputResults: 'verifyDarkExpResults'
      connections.outputStats: 'verifyDarkStats'
      connections.outputResults: 'verifyDarkResults'
      hasInputResults: true
      hasMatrixCatalog: false
  mosaicExp8:
    class: lsst.pipe.tasks.visualizeVisit.VisualizeMosaicExpTask
    config:
      connections.inputExps: 'verifyDarkProcBin8'
      connections.outputData: 'verifyDarkResidual8'
      binning: 8
  mosaicExp64:
    class: lsst.pipe.tasks.visualizeVisit.VisualizeMosaicExpTask
    config:
      connections.inputExps: 'verifyDarkProcBin64'
      connections.outputData: 'verifyDarkResidual64'
      binning: 64
  analyzeDarkCore: lsst.analysis.tools.tasks.VerifyCalibAnalysisTask
  analyzeDarkDetCore: lsst.analysis.tools.tasks.VerifyCalibDetectorTask
contracts:
  - verifyDarkApply.binFactor1 == mosaicExp8.binning
  - verifyDarkApply.binFactor2 == mosaicExp64.binning
