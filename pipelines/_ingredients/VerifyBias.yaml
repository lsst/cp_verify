description: cp_verify BIAS calibration verification
imports:
  - location: $ANALYSIS_TOOLS_DIR/pipelines/cpCore.yaml
    include:
      - analyzeBiasCore
tasks:
  verifyBiasApply:
    class: lsst.ip.isr.isrTask.IsrTask
    config:
      connections.ccdExposure: 'raw'
      connections.outputExposure: 'verifyBiasProc'
      overscan.fitType: 'MEDIAN_PER_ROW'
      doBias: true
      doVariance: true
      doLinearize: false
      doDefect: true
      doNanMasking: true
      doInterpolate: true
      doBrighterFatter: false
      doDark: false
      doFlat: false
      doApplyGains: false
      doFringe: false
      doCalculateStatistics: true
      isrStats.doCopyCalibDistributionStatistics: true
      isrStats.doProjectionStatistics: true
      isrStats.doBiasShiftStatistics: true
      isrStats.doAmplifierCorrelationStatistics: true
      doBinnedExposures: true
      binFactor1: 8
      binFactor2: 64
  verifyBiasChip:
    class: lsst.cp.verify.CpVerifyBiasTask
    config:
      connections.inputExp: 'verifyBiasProc'
      connections.taskMetadata: 'verifyBiasApply_metadata'
      connections.outputStats: 'verifyBiasDetStats'
      connections.outputResults: 'verifyBiasDetResults'
      connections.outputMatrix: 'verifyBiasDetMatrix'
      doVignette: false
      useReadNoise: true
      useIsrStatistics: true
      hasMatrixCatalog: true
  verifyBiasExp:
    class: lsst.cp.verify.CpVerifyExpMergeTask
    config:
      connections.inputStats: 'verifyBiasDetStats'
      connections.inputResults: 'verifyBiasDetResults'
      connections.inputMatrix: 'verifyBiasDetMatrix'
      connections.outputStats: 'verifyBiasExpStats'
      connections.outputResults: 'verifyBiasExpResults'
      connections.outputMatrix: 'verifyBiasExpMatrix'
      hasInputResults: true
      hasMatrixCatalog: true
  verifyBias:
    class: lsst.cp.verify.CpVerifyRunMergeTask
    config:
      connections.inputStats: 'verifyBiasExpStats'
      connections.inputResults: 'verifyBiasExpResults'
      connections.inputMatrix: 'verifyBiasExpMatrix'
      connections.outputStats: 'verifyBiasStats'
      connections.outputResults: 'verifyBiasResults'
      connections.outputMatrix: 'verifyBiasMatrix'
      hasInputResults: true
      hasMatrixCatalog: true
  analyzeBiasCore: lsst.analysis.tools.tasks.VerifyCalibAnalysisTask
  mosaicExp1:
    class: lsst.pipe.tasks.visualizeVisit.VisualizeMosaicExpTask
    config:
      connections.inputExps: 'postIsrBin1'
      connections.outputData: 'verifyBiasMosaic1'
      binning: 8
  mosaicExp2:
    class: lsst.pipe.tasks.visualizeVisit.VisualizeMosaicExpTask
    config:
      connections.inputExps: 'postIsrBin2'
      connections.outputData: 'verifyBiasMosaic2'
      binning: 64
contracts:
  - verifyBiasApply.binFactor1 == mosaicExp1.binning
  - verifyBiasApply.binFactor2 == mosaicExp2.binning
